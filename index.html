<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>KozyBeats Lofi Player</title>
<style>
  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body, html {
    margin: 0; padding: 0;
    height: 100%;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #121212;
    color: #ddd;
    overflow: hidden;
  }

  /* Background video with blur */
  #background-video {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    object-fit: cover;
    filter: blur(8px) brightness(0.7);
    z-index: -2;
  }
  #particles-canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    pointer-events: none;
    z-index: -1;
  }

  /* Layout containers */
  #container {
    display: grid;
    grid-template-columns: 220px 1fr 300px;
    grid-template-rows: 1fr 100px;
    height: 100vh;
    gap: 10px;
    padding: 15px;
  }

  /* Left sidebar (projects) */
  #projects {
    grid-column: 1;
    grid-row: 1 / span 2;
    background: rgba(20,20,20,0.85);
    border-radius: 12px;
    overflow-y: auto;
    padding: 10px;
  }
  #projects h2 {
    margin-top: 0; margin-bottom: 10px;
    font-size: 1.25rem;
    font-weight: 700;
  }
  .project-item {
    display: flex;
    align-items: center;
    margin-bottom: 12px;
    cursor: pointer;
    border-radius: 8px;
    padding: 6px;
    transition: background 0.3s ease;
  }
  .project-item:hover, .project-item.active {
    background: #333;
  }
  .project-item img {
    width: 50px;
    height: 50px;
    border-radius: 6px;
    object-fit: cover;
    margin-right: 10px;
    flex-shrink: 0;
  }
  .project-item span {
    font-size: 1rem;
    user-select: none;
  }

  /* Right sidebar (tracks) */
  #tracks {
    grid-column: 3;
    grid-row: 1 / span 2;
    background: rgba(20,20,20,0.85);
    border-radius: 12px;
    padding: 15px;
    overflow-y: auto;
  }
  #tracks h2 {
    margin-top: 0; margin-bottom: 15px;
    font-size: 1.3rem;
    font-weight: 700;
  }
  .track-item {
    background: #2b2b2b;
    margin-bottom: 10px;
    padding: 10px 12px;
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  .track-item:hover, .track-item.playing {
    background: #444;
  }
  .track-title {
    user-select: none;
    flex: 1;
    margin-right: 10px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .track-controls {
    display: flex;
    gap: 6px;
  }
  .track-button {
    background: transparent;
    border: none;
    color: #ddd;
    font-size: 1.1rem;
    cursor: pointer;
    padding: 4px;
    transition: color 0.2s ease;
  }
  .track-button:hover {
    color: #ffb86c;
  }

  /* Bottom player bar */
  #player-bar {
    grid-column: 1 / span 3;
    grid-row: 2;
    background: rgba(20,20,20,0.9);
    border-radius: 12px;
    display: flex;
    align-items: center;
    padding: 10px 20px;
    gap: 20px;
  }

  #vinyl-container {
    width: 80px;
    height: 80px;
    position: relative;
    flex-shrink: 0;
  }
  #vinyl {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    animation: spin 10s linear infinite;
    object-fit: cover;
    box-shadow: 0 0 15px rgba(255, 184, 108, 0.7);
  }
  @keyframes spin {
    from { transform: rotate(0deg);}
    to { transform: rotate(360deg);}
  }

  #now-playing-info {
    flex: 1;
    color: #ffb86c;
    font-weight: 600;
    font-size: 1.1rem;
    user-select: none;
  }

  #controls {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  button.control-btn {
    background: none;
    border: none;
    color: #ddd;
    font-size: 1.7rem;
    cursor: pointer;
    transition: color 0.25s ease;
  }
  button.control-btn:hover {
    color: #ffb86c;
  }
  button.control-btn:focus {
    outline: none;
  }

  /* Volume control */
  #volume-container {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #ddd;
    user-select: none;
  }
  #volume-slider {
    width: 120px;
    cursor: pointer;
  }

  /* Ambience toggle panel */
  #ambience-container {
    position: fixed;
    top: 15px;
    right: 15px;
    background: rgba(20,20,20,0.9);
    border-radius: 12px;
    padding: 15px;
    max-width: 280px;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 0 20px rgba(255, 184, 108, 0.5);
  }
  #ambience-container h3 {
    margin-top: 0;
    color: #ffb86c;
    font-weight: 700;
  }
  .ambience-sound {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;
  }
  .ambience-label {
    flex: 1;
    color: #ddd;
    user-select: none;
  }
  .ambience-toggle {
    margin-right: 10px;
  }
  .ambience-volume {
    width: 90px;
  }

  /* Scrollbars */
  #projects::-webkit-scrollbar,
  #tracks::-webkit-scrollbar,
  #ambience-container::-webkit-scrollbar {
    width: 8px;
  }
  #projects::-webkit-scrollbar-thumb,
  #tracks::-webkit-scrollbar-thumb,
  #ambience-container::-webkit-scrollbar-thumb {
    background-color: #ffb86c88;
    border-radius: 4px;
  }
  #projects::-webkit-scrollbar-track,
  #tracks::-webkit-scrollbar-track,
  #ambience-container::-webkit-scrollbar-track {
    background: transparent;
  }
</style>
</head>
<body>

<!-- Background video -->
<video id="background-video" autoplay muted loop playsinline>
  <source src="https://res.cloudinary.com/dvtt0ymce/video/upload/v1754228640/Cat_Mushroom_Animated_Digital_Wide_PC_Background_HD_Live_-_Etsy_Video_Video___Anime_wallpaper_Cute_wallpapers_Art_whcjmg.mp4" type="video/mp4" />
  Your browser does not support the video tag.
</video>

<!-- Canvas for drifting particles -->
<canvas id="particles-canvas"></canvas>

<div id="container">

  <!-- Projects list -->
  <aside id="projects">
    <h2>Projects & Singles</h2>
  </aside>

  <!-- Empty center area for possible future use -->
  <main id="main-content"></main>

  <!-- Tracks list -->
  <aside id="tracks">
    <h2>Tracks</h2>
    <div id="track-list"></div>
  </aside>

  <!-- Bottom player bar -->
  <section id="player-bar">
    <div id="vinyl-container">
      <img id="vinyl" src="" alt="Vinyl Cover" />
    </div>
    <div id="now-playing-info">Nothing playing</div>
    <div id="controls">
      <button id="btn-prev" class="control-btn" title="Previous Track" aria-label="Previous Track">‚èÆÔ∏è</button>
      <button id="btn-play" class="control-btn" title="Play/Pause" aria-label="Play/Pause">‚ñ∂Ô∏è</button>
      <button id="btn-next" class="control-btn" title="Next Track" aria-label="Next Track">‚è≠Ô∏è</button>
      <button id="btn-shuffle" class="control-btn" title="Shuffle" aria-label="Shuffle">üîÄ</button>
      <button id="btn-repeat" class="control-btn" title="Repeat" aria-label="Repeat">üîÅ</button>
      <button id="btn-ambience-toggle" class="control-btn" title="Toggle Ambience Panel" aria-label="Toggle Ambience Panel">üéß</button>
      <button id="btn-mute" class="control-btn" title="Mute/Unmute" aria-label="Mute/Unmute">üîà</button>
    </div>
    <div id="volume-container">
      <label for="volume-slider">Volume</label>
      <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.7" />
    </div>
  </section>

</div>

<!-- Ambience sound controls panel -->
<section id="ambience-container" style="display:none;">
  <h3>Ambience Sounds</h3>
  <!-- dynamically generated ambience controls here -->
</section>

<script>
(() => {
  /* --- DATA --- */
  const projects = [
    {
      id: 'pillowcore',
      name: 'Pillowcore Radio',
      cover: 'https://res.cloudinary.com/dvtt0ymce/image/upload/v1754227293/pillow_radio_xrdpqc.png',
      tracks: [
        { title: 'Glow Sink', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754225847/Glow_Sink_sprxbn.mp3', spotify: '' },
        { title: 'Paper Walls', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754225847/Paper_Walls_est5ei.mp3', spotify: '' },
        { title: 'Lavender Shadows', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754225846/Lavender_Shadows_s3wayo.mp3', spotify: '' },
        { title: 'Snooze Signal', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754225844/Snooze_Signal_vqjo70.mp3', spotify: '' },
        { title: 'Dream Archive', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754225842/Dream_Archive_wrtdy3.mp3', spotify: '' },
        { title: 'Warm Silence', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754225842/Warm_Silence_zxijcq.mp3', spotify: '' },
        { title: 'Curtains Closed', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754225842/Curtains_Closed_nqpgtq.mp3', spotify: '' },
        { title: 'Ceiling Fan Dreams', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754225842/Ceiling_Fan_Dreams_xqlsq7.mp3', spotify: '' },
        { title: 'Whispers in Blue', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754225841/Whispers_in_Blue_tgitgu.mp3', spotify: '' },
        { title: 'Rain on 4th Street', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754225841/Rain_on_4th_Street_vt5sb9.mp3', spotify: '' },
        { title: 'Moonlit Linen', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754225841/Moonlit_Linen_nwjuzr.mp3', spotify: '' },
        { title: 'Midnight Left on Read', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754225841/Midnight_Left_on_Read_vy5iqm.mp3', spotify: '' },
      ],
    },
    {
      id: 'eveningstatic',
      name: 'Evening Static',
      cover: 'https://res.cloudinary.com/dvtt0ymce/image/upload/v1754229102/056f89b5bdd7b2944636c4e480196abe_1_bhyub6.jpg',
      tracks: [
        { title: 'Curtains Breathing Slow', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754229134/Curtains_Breathing_Slow_si8vdi.mp3', spotify: '' },
        { title: 'Heard My Name in the Hiss', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754229134/Heard_My_Name_in_the_Hiss_yi1jfb.mp3', spotify: '' },
        { title: 'Stayed Just Long Enough', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754229136/Stayed_Just_Long_Enough_wlkxsb.mp3', spotify: '' },
        { title: 'Memories on the Window Glass', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754229137/Memories_on_the_Window_Glass_uw4vxm.mp3', spotify: '' },
        { title: 'TV Snow in My Mind', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754229138/TV_Snow_in_My_Mind_oxtsqi.mp3', spotify: '' },
        { title: 'Pages Left Open', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754229139/Pages_Left_Open_r4bxvz.mp3', spotify: '' },
        { title: 'The Fan Still Spins', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754229139/The_Fan_Still_Spins_qba31z.mp3', spotify: '' },
        { title: 'When the Floorboard Creaked', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754229142/When_the_Floorboard_Creaked_ljcd2m.mp3', spotify: '' },
        { title: 'A Thread Pulled from the Moon', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754229143/A_Thread_Pulled_from_the_Moon_kqjhdq.mp3', spotify: '' },
        { title: 'Between the Glow and the Silence', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754229143/Between_the_Glow_and_the_Silence_xv6mht.mp3', spotify: '' },
      ],
    },
    // Example single project:
    {
      id: 'singles',
      name: 'Singles',
      cover: '',
      tracks: [
        { title: 'Single Track Example', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754230000/single_track_example.mp3', spotify: '' },
        // add your singles here manually or later via code
      ],
    }
  ];

  /* --- AMBIENCE SOUNDS --- */
  const ambienceSoundsData = [
    { id: 'rain', label: 'Rain', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754236332/Rain_5_ommf7e.wav' },
    { id: 'vinyl', label: 'Vinyl Crackle', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754236422/Vinyl_1_lrn7bh.wav' },
    { id: 'coffee', label: 'Coffee Shop', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754236698/sandwich-cafe-31183_wnkw8j.mp3' },
    { id: 'fireplace', label: 'Fireplace Crackling', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754236735/campfirefireplace-crackling-268525_bg9ksg.mp3' },
    { id: 'wind', label: 'Soft Wind & Chimes', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754236875/wind-blowing-sfx-12809_ptsspy.mp3' },
    { id: 'city', label: 'City Night Ambiance', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754236956/015965_city-night-56166_ebsgdp.mp3' },
    { id: 'typing', label: 'Typing Sounds', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754237017/typing-keyboard-sound-254462_t0ppdc.mp3' },
    { id: 'birds', label: 'Birds Chirping', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754237083/Outside_2_exboxa.wav' },
    { id: 'ocean', label: 'Ocean Waves', src: 'https://res.cloudinary.com/dvtt0ymce/video/upload/v1754237120/Beach_2_r7t5yw.wav' }
  ];

  /* --- STATE --- */
  let currentProjectIndex = 0;
  let currentTrackIndex = 0;
  let isPlaying = false;
  let shuffle = false;
  let repeatTrack = false;
  let audio = new Audio();
  let ambienceAudios = {};
  let ambienceStates = {};
  let ambienceVolumes = {};
  let isMuted = false;
  let userVolume = 0.7;

  /* --- DOM ELEMENTS --- */
  const projectsContainer = document.getElementById('projects');
  const tracksContainer = document.getElementById('track-list');
  const nowPlayingInfo = document.getElementById('now-playing-info');
  const vinylImg = document.getElementById('vinyl');
  const btnPlay = document.getElementById('btn-play');
  const btnNext = document.getElementById('btn-next');
  const btnPrev = document.getElementById('btn-prev');
  const btnShuffle = document.getElementById('btn-shuffle');
  const btnRepeat = document.getElementById('btn-repeat');
  const btnMute = document.getElementById('btn-mute');
  const volumeSlider = document.getElementById('volume-slider');
  const ambienceContainer = document.getElementById('ambience-container');
  const btnAmbienceToggle = document.getElementById('btn-ambience-toggle');

  /* --- UTILS --- */
  function formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60).toString().padStart(2, '0');
    return `${mins}:${secs}`;
  }

  /* --- RENDER PROJECTS --- */
  function renderProjects() {
    projectsContainer.innerHTML = `<h2>Projects & Singles</h2>`;
    projects.forEach((project, i) => {
      const div = document.createElement('div');
      div.classList.add('project-item');
      if (i === currentProjectIndex) div.classList.add('active');
      div.dataset.index = i;
      div.title = project.name;

      const img = document.createElement('img');
      img.src = project.cover || 'https://res.cloudinary.com/dvtt0ymce/image/upload/v1754230124/Vinyl-PNG-Transparent-Image_lnmiyw.png';
      img.alt = project.name + ' Cover';

      const span = document.createElement('span');
      span.textContent = project.name;

      div.appendChild(img);
      div.appendChild(span);

      div.addEventListener('click', () => {
        if (currentProjectIndex !== i) {
          currentProjectIndex = i;
          renderProjects();
          renderTracks();
        }
      });

      projectsContainer.appendChild(div);
    });
  }

  /* --- RENDER TRACKS --- */
  function renderTracks() {
    const project = projects[currentProjectIndex];
    tracksContainer.innerHTML = '';
    tracksContainer.previousElementSibling.textContent = project.name + ' Tracks';

    project.tracks.forEach((track, idx) => {
      const div = document.createElement('div');
      div.classList.add('track-item');
      if (currentTrackIndex === idx && currentProjectIndex === currentProjectIndex && isPlaying) div.classList.add('playing');
      div.dataset.index = idx;

      const title = document.createElement('div');
      title.classList.add('track-title');
      title.textContent = track.title;

      const controls = document.createElement('div');
      controls.classList.add('track-controls');

      // Play button
      const playBtn = document.createElement('button');
      playBtn.classList.add('track-button');
      playBtn.title = 'Play this track';
      playBtn.innerHTML = '‚ñ∂Ô∏è';
      playBtn.addEventListener('click', e => {
        e.stopPropagation();
        playTrack(idx);
      });

      // Spotify button (opens in new tab if link exists)
      const spotifyBtn = document.createElement('button');
      spotifyBtn.classList.add('track-button');
      spotifyBtn.title = 'Open on Spotify';
      spotifyBtn.innerHTML = 'üéµ';
      spotifyBtn.disabled = !track.spotify;
      spotifyBtn.style.opacity = track.spotify ? '1' : '0.3';
      spotifyBtn.addEventListener('click', e => {
        e.stopPropagation();
        if (track.spotify) window.open(track.spotify, '_blank');
      });

      controls.appendChild(playBtn);
      controls.appendChild(spotifyBtn);

      div.appendChild(title);
      div.appendChild(controls);

      // Clicking whole track also plays track
      div.addEventListener('click', () => playTrack(idx));

      tracksContainer.appendChild(div);
    });
  }

  /* --- PLAY TRACK --- */
  function playTrack(index) {
    if (index < 0 || index >= projects[currentProjectIndex].tracks.length) return;
    currentTrackIndex = index;
    audio.src = projects[currentProjectIndex].tracks[currentTrackIndex].src;
    audio.play();
    isPlaying = true;
    updateUI();
  }

  /* --- UPDATE UI --- */
  function updateUI() {
    // Projects active highlight
    Array.from(projectsContainer.querySelectorAll('.project-item')).forEach((el, i) => {
      el.classList.toggle('active', i === currentProjectIndex);
    });

    // Tracks highlight
    Array.from(tracksContainer.querySelectorAll('.track-item')).forEach((el, i) => {
      el.classList.toggle('playing', i === currentTrackIndex && isPlaying);
    });

    // Now playing info
    const project = projects[currentProjectIndex];
    const track = project.tracks[currentTrackIndex];
    if (isPlaying) {
      nowPlayingInfo.textContent = `Now Playing: KozyBeats - ${track.title}`;
    } else {
      nowPlayingInfo.textContent = `Paused: KozyBeats - ${track.title}`;
    }

    // Vinyl cover changes to current track cover (fallback to project cover if no specific cover)
    vinylImg.src = project.cover || 'https://res.cloudinary.com/dvtt0ymce/image/upload/v1754230124/Vinyl-PNG-Transparent-Image_lnmiyw.png';

    // Play/Pause button icon
    btnPlay.textContent = isPlaying ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è';

    // Repeat button style
    btnRepeat.style.color = repeatTrack ? '#ffb86c' : '#ddd';

    // Shuffle button style
    btnShuffle.style.color = shuffle ? '#ffb86c' : '#ddd';

    // Mute button icon
    btnMute.textContent = isMuted ? 'üîá' : 'üîà';
  }

  /* --- NEXT TRACK --- */
  function nextTrack() {
    const project = projects[currentProjectIndex];
    if (shuffle) {
      currentTrackIndex = Math.floor(Math.random() * project.tracks.length);
    } else {
      currentTrackIndex++;
      if (currentTrackIndex >= project.tracks.length) {
        currentTrackIndex = 0;
        // Move to next project automatically after project done
        currentProjectIndex++;
        if (currentProjectIndex >= projects.length) currentProjectIndex = 0;
        renderProjects();
        renderTracks();
      }
    }
    playTrack(currentTrackIndex);
  }

  /* --- PREVIOUS TRACK --- */
  function prevTrack() {
    const project = projects[currentProjectIndex];
    if (shuffle) {
      currentTrackIndex = Math.floor(Math.random() * project.tracks.length);
    } else {
      currentTrackIndex--;
      if (currentTrackIndex < 0) {
        currentProjectIndex--;
        if (currentProjectIndex < 0) currentProjectIndex = projects.length - 1;
        renderProjects();
        renderTracks();
        currentTrackIndex = projects[currentProjectIndex].tracks.length - 1;
      }
    }
    playTrack(currentTrackIndex);
  }

  /* --- SHUFFLE TOGGLE --- */
  btnShuffle.addEventListener('click', () => {
    shuffle = !shuffle;
    updateUI();
  });

  /* --- REPEAT TOGGLE --- */
  btnRepeat.addEventListener('click', () => {
    repeatTrack = !repeatTrack;
    updateUI();
  });

  /* --- PLAY/PAUSE TOGGLE --- */
  btnPlay.addEventListener('click', () => {
    if (!audio.src) {
      playTrack(currentTrackIndex);
      return;
    }
    if (isPlaying) {
      audio.pause();
    } else {
      audio.play();
    }
  });

  /* --- NEXT & PREV BUTTONS --- */
  btnNext.addEventListener('click', () => {
    nextTrack();
  });
  btnPrev.addEventListener('click', () => {
    prevTrack();
  });

  /* --- AUDIO EVENTS --- */
  audio.addEventListener('play', () => {
    isPlaying = true;
    updateUI();
  });
  audio.addEventListener('pause', () => {
    isPlaying = false;
    updateUI();
  });
  audio.addEventListener('ended', () => {
    if (repeatTrack) {
      playTrack(currentTrackIndex);
    } else {
      nextTrack();
    }
  });

  /* --- VOLUME CONTROL --- */
  volumeSlider.addEventListener('input', () => {
    userVolume = volumeSlider.value;
    audio.volume = isMuted ? 0 : userVolume;
  });

  /* --- MUTE TOGGLE --- */
  btnMute.addEventListener('click', () => {
    isMuted = !isMuted;
    audio.volume = isMuted ? 0 : userVolume;
    updateUI();
  });

  /* --- AMBIENCE SOUNDS SETUP --- */
  function createAmbienceControls() {
    ambienceContainer.innerHTML = `<h3>Ambience Sounds</h3>`;
    ambienceSoundsData.forEach(sound => {
      const div = document.createElement('div');
      div.classList.add('ambience-sound');

      const label = document.createElement('label');
      label.classList.add('ambience-label');
      label.htmlFor = `ambience-${sound.id}`;
      label.textContent = sound.label;

      const toggle = document.createElement('input');
      toggle.type = 'checkbox';
      toggle.classList.add('ambience-toggle');
      toggle.id = `ambience-${sound.id}`;
      toggle.checked = false;

      const volume = document.createElement('input');
      volume.type = 'range';
      volume.min = 0; volume.max = 1; volume.step = 0.01;
      volume.value = 0.5;
      volume.classList.add('ambience-volume');
      volume.id = `ambience-volume-${sound.id}`;

      div.appendChild(label);
      div.appendChild(toggle);
      div.appendChild(volume);

      ambienceContainer.appendChild(div);

      // Create audio element for this ambience sound
      const ambienceAudio = new Audio(sound.src);
      ambienceAudio.loop = true;
      ambienceAudio.volume = 0.5;
      ambienceAudios[sound.id] = ambienceAudio;
      ambienceStates[sound.id] = false;
      ambienceVolumes[sound.id] = 0.5;

      // Toggle ambience sound play/pause
      toggle.addEventListener('change', () => {
        if (toggle.checked) {
          ambienceAudio.play();
          ambienceStates[sound.id] = true;
        } else {
          ambienceAudio.pause();
          ambienceStates[sound.id] = false;
        }
      });

      // Volume slider for ambience
      volume.addEventListener('input', () => {
        ambienceVolumes[sound.id] = volume.value;
        ambienceAudio.volume = volume.value;
      });
    });
  }

  btnAmbienceToggle.addEventListener('click', () => {
    if (ambienceContainer.style.display === 'none') {
      ambienceContainer.style.display = 'block';
    } else {
      ambienceContainer.style.display = 'none';
    }
  });

  /* --- PARTICLES CANVAS SETUP --- */
  const canvas = document.getElementById('particles-canvas');
  const ctx = canvas.getContext('2d');
  let particles = [];
  let W, H;

  function resizeCanvas() {
    W = window.innerWidth;
    H = window.innerHeight;
    canvas.width = W;
    canvas.height = H;
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  function createParticles() {
    particles = [];
    for (let i = 0; i < 40; i++) {
      particles.push({
        x: Math.random() * W,
        y: Math.random() * H,
        radius: 2 + Math.random() * 2,
        speedX: (Math.random() - 0.5) * 0.15,
        speedY: (Math.random() - 0.5) * 0.15,
        alpha: 0.05 + Math.random() * 0.07
      });
    }
  }
  createParticles();

  function drawParticles() {
    ctx.clearRect(0, 0, W, H);
    particles.forEach(p => {
      ctx.beginPath();
      ctx.fillStyle = `rgba(255, 184, 108, ${p.alpha})`;
      ctx.shadowColor = `rgba(255, 184, 108, ${p.alpha})`;
      ctx.shadowBlur = 10;
      ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
      ctx.fill();

      p.x += p.speedX;
      p.y += p.speedY;

      // Wrap around edges
      if (p.x < 0) p.x = W;
      else if (p.x > W) p.x = 0;
      if (p.y < 0) p.y = H;
      else if (p.y > H) p.y = 0;
    });
  }

  function animate() {
    drawParticles();
    requestAnimationFrame(animate);
  }
  animate();

  /* --- INIT --- */
  renderProjects();
  renderTracks();
  createAmbienceControls();
  updateUI();

  /* --- Start paused, no audio src, user sets play --- */
  audio.volume = userVolume;

})();
</script>

</body>
</html>
